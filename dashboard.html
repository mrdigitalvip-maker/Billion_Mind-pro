<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BillionMind â€“ Dashboard</title>

<style>
  :root {
    --black: #0a0a0c;
    --panel: #111116;
    --gold: #f4c86c;
    --gold-soft: rgba(244, 200, 108, 0.2);
    --text: #e4e4e4;
    --text-soft: #9d9d9d;
    --radius: 18px;
    --shadow: 0 0 40px rgba(0, 0, 0, 0.65);
  }

  body {
    margin: 0;
    background: var(--black);
    color: var(--text);
    font-family: system-ui, sans-serif;
    overflow-x: hidden;
  }

  header {
    padding: 22px 30px;
    background: #000;
    border-bottom: 1px solid var(--gold-soft);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .logo {
    font-size: 1.4rem;
    font-weight: bold;
    color: var(--gold);
    letter-spacing: 0.08em;
  }

  .plan-badge {
    padding: 6px 14px;
    border-radius: 999px;
    border: 1px solid var(--gold-soft);
    background: rgba(255,255,255,0.05);
    font-size: 0.82rem;
    color: var(--gold);
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 30px 20px;
  }

  .section {
    background: var(--panel);
    padding: 22px;
    border-radius: var(--radius);
    border: 1px solid rgba(255,255,255,0.05);
    margin-bottom: 26px;
    box-shadow: var(--shadow);
  }

  .section h2 {
    color: var(--gold);
    margin-bottom: 12px;
    font-size: 1.2rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .chat-box {
    width: 100%;
    height: 280px;
    background: #000;
    border-radius: var(--radius);
    padding: 16px;
    overflow-y: auto;
    border: 1px solid var(--gold-soft);
    margin-bottom: 14px;
    font-size: 0.95rem;
  }

  .msg-user {
    text-align: right;
    color: var(--gold);
    margin-bottom: 8px;
  }

  .msg-ai {
    text-align: left;
    color: var(--text);
    margin-bottom: 12px;
  }

  .chat-input {
    display: flex;
    gap: 10px;
  }

  .chat-input input {
    flex: 1;
    padding: 12px;
    border-radius: var(--radius);
    border: none;
    background: rgba(255,255,255,0.08);
    color: white;
  }

  .chat-input button {
    padding: 12px 20px;
    border-radius: var(--radius);
    border: none;
    background: linear-gradient(120deg, var(--gold), #e1a93f);
    cursor: pointer;
    font-weight: bold;
  }

  .locked {
    opacity: 0.4;
    position: relative;
  }

  .locked::after {
    content: "ðŸ”’ FunÃ§Ã£o disponÃ­vel apenas no PRO / PREMIUM";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--gold);
    font-size: 0.9rem;
    background: rgba(0,0,0,0.7);
    padding: 6px 14px;
    border-radius: 10px;
    border: 1px solid var(--gold-soft);
  }

  .upgrade-btn {
    margin-top: 12px;
    padding: 14px;
    border-radius: 999px;
    background: var(--gold);
    border: none;
    cursor: pointer;
    font-weight: bold;
    width: 100%;
    text-align: center;
    color: #000;
    font-size: 1rem;
  }

  .logout {
    margin-top: 20px;
    text-align: center;
    cursor: pointer;
    color: var(--text-soft);
    font-size: 0.9rem;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
<header>
  <div class="logo">BillionMind AI</div>
  <div id="planBadge" class="plan-badge">Carregando...</div>
</header>

<div class="container">

  <!-- CHAT LIVRE -->
  <div class="section">
    <h2>Chat Inteligente</h2>
    <div id="chatBox" class="chat-box"></div>

    <div class="chat-input">
      <input id="chatInput" placeholder="Digite sua mensagem..." />
      <button onclick="sendMessage()">Enviar</button>
    </div>
  </div>

  <!-- FERRAMENTAS AVANÃ‡ADAS -->
  <div class="section locked" id="advancedArea">
    <h2>Ferramentas AvanÃ§adas</h2>
    <p>Gerador de estratÃ©gias, criaÃ§Ã£o automÃ¡tica e painÃ©is premium.</p>
  </div>

  <!-- BOTÃ•ES DE UPGRADE -->
  <button class="upgrade-btn"
    onclick="window.location.href='https://buy.stripe.com/14AcN5buodjRewI8cQcAo01'">
    ðŸ”“ Desbloquear Plano PRO â€“ R$ 29,98/mÃªs
  </button>

  <button class="upgrade-btn"
    onclick="window.location.href='https://buy.stripe.com/cNiaEX1TOfrZ2O08cQcAo02'">
    ðŸš€ Desbloquear Plano PREMIUM â€“ R$ 39,90/mÃªs
  </button>

  <div class="logout" onclick="logout()">Sair da conta</div>
</div>

<script>
  const supabaseUrl = "https://lppjltjoxczooxsbtlyr.supabase.co";
  const supabaseKey =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxwcGpsdGpveGN6b294c2J0bHlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNDY4MTUsImV4cCI6MjA4MDYyMjgxNX0.AK0i5gbTk12z6dgIrNYkFoi6LQMFocSxbi9lka-GZrc";

  const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
  let currentUser = null;

  async function loadUser() {
    const { data } = await supabaseClient.auth.getUser();
    if (!data.user) {
      window.location.href = "index.html";
      return;
    }
    currentUser = data.user;
    await loadPlan();
  }

  async function loadPlan() {
    const { data } = await supabaseClient
      .from("profiles")
      .select("plan")
      .eq("id", currentUser.id)
      .single();

    const badge = document.getElementById("planBadge");
    if (!data || !data.plan) {
      badge.textContent = "Plano: Free";
      return;
    }

    badge.textContent = "Plano: " + data.plan.toUpperCase();

    if (data.plan === "pro" || data.plan === "premium") {
      document.getElementById("advancedArea").classList.remove("locked");
    }
  }

  async function sendMessage() {
    const input = document.getElementById("chatInput");
    const msg = input.value.trim();
    if (!msg) return;

    const box = document.getElementById("chatBox");
    box.innerHTML += `<div class='msg-user'>VocÃª: ${msg}</div>`;
    input.value = "";

    try {
      const response = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg }),
      });

      const data = await response.json();
      box.innerHTML += `<div class='msg-ai'>AI: ${data.reply}</div>`;
    } catch (err) {
      box.innerHTML += `<div class='msg-ai'>Erro na conexÃ£o com a IA.</div>`;
    }

    box.scrollTop = box.scrollHeight;
  }

  async function logout() {
    await supabaseClient.auth.signOut();
    window.location.href = "index.html";
  }

  loadUser();
</script>
</body>
</html>
