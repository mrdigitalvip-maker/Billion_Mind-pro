<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BillionMind â€¢ Dashboard</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, sans-serif;
      background: #05060a;
      color: #ffffff;
    }

    header {
      padding: 16px;
      background: #0b0d14;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .plan-tag {
      padding: 6px 12px;
      background: #f4c86c;
      color: #000;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
    }

    #logoutBtn {
      padding: 8px 14px;
      border-radius: 20px;
      background: transparent;
      color: #f4c86c;
      border: 1px solid #f4c86c;
      cursor: pointer;
    }

    .locked {
      opacity: 0.4;
      filter: blur(3px);
      pointer-events: none;
    }

    /* CHAT */
    .chat-box {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #0c0d16;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    textarea {
      width: 100%;
      height: 120px;
      padding: 12px;
      border-radius: 10px;
      background: #11121f;
      color: #fff;
      border: 1px solid rgba(255,255,255,0.2);
      resize: none;
    }

    button.send {
      margin-top: 10px;
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(120deg, #f4c86c, #e1a93f);
      color: #000;
      font-weight: 700;
      cursor: pointer;
      font-size: 1rem;
    }

    #response {
      margin-top: 20px;
      padding: 16px;
      background: #10121f;
      border-radius: 10px;
      min-height: 80px;
      white-space: pre-wrap;
      border: 1px solid rgba(255,255,255,0.1);
    }
  </style>
</head>

<body>

<header>
  <h2>BillionMind Dashboard</h2>
  <div id="userPlanTag" class="plan-tag">Carregando...</div>
  <button id="logoutBtn">Sair</button>
</header>

<div id="lockMessage" style="text-align:center; font-size:1.2rem; margin-top:20px; display:none;">
  ðŸ”’ Este recurso Ã© exclusivo para assinantes PRO e VIP.<br>
  <a href="/index.html" style="color:#f4c86c; text-decoration:underline;">Atualizar plano</a>
</div>

<div id="contentArea" class="chat-box locked">
  <textarea id="prompt" placeholder="Digite sua pergunta..."></textarea>
  <button class="send" onclick="sendMessage()">Enviar</button>
  <div id="response">Aguardando interaÃ§Ã£o...</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* ðŸ”¥ 1 â€” CONECTAR SUPABASE */
const supabase = supabase.createClient(
  "https://lppjltjoxczooxsbtlyr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxwcGpsdGpveGN6b294c2J0bHlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNDY4MTUsImV4cCI6MjA4MDYyMjgxNX0.AK0i5gbTk12z6dgIrNYkFoi6LQMFocSxbi9lka-GZrc"
);

/* ðŸ”¥ 2 â€” VERIFICAR LOGIN */
async function checkLogin() {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    window.location.href = "/login.html";
    return;
  }

  loadUserPlan(user.id);
}
checkLogin();

/* ðŸ”¥ 3 â€” CARREGAR PLANO DO USUÃRIO */
async function loadUserPlan(userId) {
  const { data, error } = await supabase
    .from("profiles")
    .select("plan")
    .eq("id", userId)
    .single();

  const tag = document.getElementById("userPlanTag");
  const content = document.getElementById("contentArea");
  const lockMsg = document.getElementById("lockMessage");

  if (error || !data) {
    tag.textContent = "Plano nÃ£o encontrado";
    return;
  }

  const plan = data.plan;

  tag.textContent = plan.toUpperCase();

  if (plan === "free") {
    content.classList.add("locked");
    lockMsg.style.display = "block";
  } else {
    content.classList.remove("locked");
    lockMsg.style.display = "none";
  }
}

/* ðŸ”¥ 4 â€” LOGOUT */
document.getElementById("logoutBtn").onclick = async () => {
  await supabase.auth.signOut();
  window.location.href = "/login.html";
};

/* ðŸ”¥ 5 â€” CHAT IA */
async function sendMessage() {
  const prompt = document.getElementById("prompt").value;
  const output = document.getElementById("response");

  if (!prompt.trim()) return;

  output.textContent = "Processando...";

  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",

      /* 
         âš ï¸âš ï¸âš ï¸ AQUI VOCÃŠ COLOCA SUA CHAVE DE API DA IA âš ï¸âš ï¸âš ï¸
         SUBSTITUA O TEXTO ABAIXO PELO SEU TOKEN VERDADEIRO 
      */

      "Authorization": "Bearer SUA API AQUI"
    },
    body: JSON.stringify({
      model: "gpt-4o-mini",
      messages: [
        { role: "system", content: "VocÃª Ã© o assistente oficial BillionMind." },
        { role: "user", content: prompt }
      ]
    })
  });

  const data = await response.json();

  if (data?.choices?.length > 0) {
    output.textContent = data.choices[0].message.content;
  } else {
    output.textContent = "Erro ao gerar resposta.";
  }
}
</script>

</body>
</html>
